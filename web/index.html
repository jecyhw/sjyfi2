<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,Chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<title></title>
<link href="sjyfi/js/bootstrap/css/bootstrap.css" rel="stylesheet" media="screen">
<script type="text/javascript" src="sjyfi/js/jquery.js"></script>
<script src="sjyfi/js/bootstrap/js/alert.js"></script>
<script src="sjyfi/js/form-validator/jquery.form-validator.js"></script>
<script src="sjyfi/js/common.js"></script>

<script type="text/javascript">
	$(document).ready(function() {
        var Sys = {};
        var ua = navigator.userAgent.toLowerCase();
        if (window.ActiveXObject)
            Sys.ie = ua.match(/msie ([\d.]+)/)[1];
        /* else if (document.getBoxObjectFor)
         Sys.firefox = ua.match(/firefox\/([\d.]+)/)[1];
         else if (window.MessageEvent && !document.getBoxObjectFor)
         Sys.chrome = ua.match(/chrome\/([\d.]+)/)[1];
         else if (window.opera)
         Sys.opera = ua.match(/opera.([\d.]+)/)[1];
         else if (window.openDatabase)
         Sys.safari = ua.match(/version\/([\d.]+)/)[1];*/

        //以下进行测试
        if (parseFloat(Sys.ie) < 8.0) {
            $(document.body).html( '<div class="alert alert-danger">'
                    + '<h4>错误！</h4>'
                    +'<p>浏览器版本太低：'+ ua + '。</p>'
                    +'<p><strong>请使用ie8(包括ie8)以上的浏览器或者其它主流浏览器，现在你可以通过升级浏览器或者使用其它浏览器来解决该问题，否则无法使用该系统。</strong></p>'
                    + '</div>');
            return;
        }


        /* if(Sys.firefox) document.write('Firefox: '+Sys.firefox);
         if(Sys.chrome) document.write('Chrome: '+Sys.chrome);
         if(Sys.opera) document.write('Opera: '+Sys.opera);
         if(Sys.safari) document.write('Safari: '+Sys.safari);*/

		$.validate({
			ignore: ["remember"],
			onSuccess : function($form) {
                $.ajax({
                    url: "/sjyfi2/UserLoginServlet",
                    cache: false,
                    async: false,
                    type: "post",
                    data: {
                        account: $form.find("#account").val(),
                        pwd: $form.find("#pwd").val()
                    },
                    dataType: "json",
                    success: function(data){
                        if (data.result == "true") {
                            window.location.href = "sjyfi/trackRecord.jsp";
                        } else {
                            bsAlertDanger($form, "login-error", "用户名或密码错误！");
                        }
                    },
                    error: function(xhr, b){
                        bsAlertDanger($form, "login-error", "登陆过程中出现错误,错误类型为:" + xhr.status + " " + xhr.statusText);
                    },
                    beforeSend: function() {
                        $('.form-overlay').show();
                    },
                    complete: function() {
                        $('.form-overlay').hide();
                    }
                });
                return false;
            }
		});
		$(document).keydown(function(e) {
			if (e.keyCode == 13) {
				$("button[type='submit']").click();
			}
		});
		
		
	});
</script>
<style type="text/css">
.form-signin {
	width: 330px;
	padding: 15px;
	margin: 0px auto;
    position: relative;
}
.form-overlay {
    position: absolute;
    top: 0px;
    left: 0px;
    right: 0px;
    bottom: 0px;
    cursor: pointer;
    z-index: 100;
    background: url('sjyfi/js/fancybox/fancybox_overlay.png');
    display: none;
}


.login-loading {
    position: absolute;
    top: 50%;
    left: 50%;
    margin-top: -22px;
    margin-left: -22px;
    opacity: 0.8;
    filter:alpha(opacity=80);
    background: url('sjyfi/js/fancybox/fancybox_sprite.png') 0px -108px;
}
.login-loading div {
    width: 44px;
    height: 44px;
    background: url('sjyfi/js/fancybox/fancybox_loading.gif') center center no-repeat;
}
</style>
</head>
<body>
	<div class="container">
		<form class="form-signin" role="form">
			<div class="page-header">
				<h2>用户登录</h2>
			</div>

			<div class="form-group">
				<label for="account" class="control-label">用户名</label> <input
					type="text" class="form-control input-lg" name="account" id="account"
					placeholder="请输入用户名" data-validation="required" data-validation-error-msg="用户名不能为空" autofocus="autofocus">
			</div>
			<div class="form-group">
				<label for="pwd" class="control-label">密码</label> <input
					type="password" class="form-control input-lg" name="pwd" id="pwd" 
					placeholder="请输入密码"  data-validation="required" data-validation-error-msg="密码不能为空">
			</div>
            <div class="form-group">
			    <button type="submit" class="btn btn-primary btn-lg btn-block">登陆</button>
            </div>
            <div class="form-overlay"><div class="login-loading"><div></div></div></div>
        </form>
	</div>
</body>
</html>